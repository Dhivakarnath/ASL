<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Feed</title>
</head>
<body>
    <h1>Live Video Feed</h1>
    <video id="videoElement" width="640" height="480" autoplay></video>

    <script>
        // Extract user_id from the URL (from /video_stream/{user_id})
        const userId = window.location.pathname.split('/').pop();  // Get user_id from URL

        // Create a WebSocket connection using the Ngrok public URL and dynamic user_id
        const socket = new WebSocket(`wss://6ad0-103-196-29-170.ngrok-free.app/video_stream/${userId}`);

        // When the WebSocket connection is opened
        socket.onopen = function() {
            console.log('WebSocket connection opened');
        };

        // Handle incoming video frames
        socket.onmessage = function(event) {
            console.log('Received frame from WebSocket');
            const arrayBuffer = event.data;
            const blob = new Blob([arrayBuffer], { type: 'image/jpeg' });
            const url = URL.createObjectURL(blob);
            document.getElementById('videoElement').src = url;
        };

        // Handle WebSocket close event
        socket.onclose = function() {
            console.log('WebSocket connection closed');
        };

        // Handle WebSocket errors
        socket.onerror = function(error) {
            console.error('WebSocket error: ', error);
        };
    </script>
</body>
</html>
